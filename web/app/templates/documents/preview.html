{% extends "base.html" %}

{% block title %}Предпросмотр - {{ document.title }} | НИР Ассистент{% endblock %}

{% block styles %}
<style>
    @page {
        size: A4;
        margin: 2cm;
    }
    
    .preview-container {
        font-family: "Times New Roman", Times, serif;
        font-size: 14pt;
        line-height: 1.5;
        max-width: 210mm;
        margin: 0 auto;
        padding: 2cm;
        background-color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    .preview-container h1 {
        font-size: 16pt;
        font-weight: bold;
        text-align: center;
        margin-bottom: 1cm;
    }
    
    .preview-container h2 {
        font-size: 14pt;
        font-weight: bold;
        margin-top: 1cm;
        margin-bottom: 0.5cm;
    }
    
    .preview-container p {
        text-indent: 1.25cm;
        margin-bottom: 0.5cm;
        text-align: justify;
    }
    
    .preview-container .section {
        margin-bottom: 1cm;
    }
    
    .preview-container .section-title {
        font-weight: bold;
        text-align: center;
        margin-bottom: 0.5cm;
    }
    
    @media print {
        .no-print {
            display: none;
        }
        
        body {
            margin: 0;
            padding: 0;
        }
        
        .preview-container {
            box-shadow: none;
            padding: 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="no-print bg-white shadow overflow-hidden sm:rounded-lg mb-4 max-w-7xl mx-auto">
    <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
        <h1 class="text-xl font-bold text-gray-900">Предпросмотр: {{ document.title }}</h1>
        <div class="flex space-x-2">
            <button onclick="window.print()" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <svg class="mr-2 -ml-1 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" />
                </svg>
                Печать
            </button>
            <div class="relative" x-data="{ open: false }">
                <button @click="open = !open" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Экспорт
                    <svg class="ml-2 -mr-0.5 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
                <div x-show="open" 
                     @click.away="open = false"
                     class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" 
                     role="menu" 
                     aria-orientation="vertical" 
                     aria-labelledby="export-menu-button" 
                     tabindex="-1">
                    <a href="{{ url_for('documents.export_document', document_id=document.id, format='docx') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem" tabindex="-1">Экспорт в DOCX</a>
                    <a href="{{ url_for('documents.export_document', document_id=document.id, format='pdf') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem" tabindex="-1">Экспорт в PDF</a>
                </div>
            </div>
            <a href="{{ url_for('documents.edit_structured', document_id=document.id) }}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Вернуться к редактированию
            </a>
        </div>
    </div>
</div>

<div class="preview-container">
    {% for section, content in sections %}
    <div class="section">
        <div class="section-title">{{ section.name }}</div>
        <div class="section-content">
            {{ content.content|safe }}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

